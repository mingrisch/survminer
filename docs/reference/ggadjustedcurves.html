<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Adjusted Survival Curves for Cox Proportional Hazards Model — ggadjustedcurves • survminer</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">survminer</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../survminer_cheatsheet.pdf">Cheatseet</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/kassambara/survminer">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Adjusted Survival Curves for Cox Proportional Hazards Model</h1>
    </div>

    
    <p>This function plots adjusted survival curves for the <code>coxph</code> model.
The main idea behind this function is to present expected survival curves calculated based on Cox model separately for subpopulations. The very detailed description and interesting discussion of adjusted curves is presented in &#39;Adjusted Survival Curves&#39; by Terry Therneau, Cynthia Crowson, Elizabeth Atkinson (2015) <code>https://cran.r-project.org/web/packages/survival/vignettes/adjcurve.pdf</code>.
Many approaches are discussed in this article. Currently four approaches (two unbalanced, one conditional and one marginal) are implemented in the <code>ggadjustedcurves()</code> function. See the section Details.</p>
    

    <pre><span class='fu'>ggadjustedcurves</span>(<span class='no'>fit</span>, <span class='kw'>variable</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>reference</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"conditional"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>palette</span> <span class='kw'>=</span> <span class='st'>"hue"</span>,
  <span class='kw'>ylab</span> <span class='kw'>=</span> <span class='st'>"Survival rate"</span>, <span class='kw'>ggtheme</span> <span class='kw'>=</span> <span class='fu'><a href='theme_survminer.html'>theme_survminer</a></span>(), <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <dl class="dl-horizontal">
      <dt>fit</dt>
      <dd>an object of class coxph.object - created with coxph function.</dd>
      <dt>variable</dt>
      <dd>a character, name of the grouping variable to be plotted. If not supplied then it will be extracted from the model formula from the <code>strata()</code> component. If there is no <code>strata()</code> component then only a single curve will be plotted - average for the thole population.</dd>
      <dt>data</dt>
      <dd>a dataset for predictions. If not supplied then data will be extracted from the <code>fit</code> object.</dd>
      <dt>reference</dt>
      <dd>a dataset for reference population, to which dependent variables should be balanced. If not specified, then the <code>data</code> will be used instead. Note that the <code>reference</code> dataset should contain all variables used in <code>fit</code> object.</dd>
      <dt>method</dt>
      <dd>a character, describes how the expected survival curves shall be calculated. Possible options:
&#39;single&#39; (average for population), &#39;average&#39; (averages for subpopulations), &#39;marginal&#39;, &#39;conditional&#39; (averages for subpopulations after rebalancing). See the Details section  for further informatio.</dd>
      <dt>fun</dt>
      <dd>an arbitrary function defining a transformation of the survival
curve.  Often used transformations can be specified with a character
argument: &quot;event&quot; plots cumulative events (f(y) = 1-y), &quot;cumhaz&quot; plots the
cumulative hazard function (f(y) = -log(y)), and &quot;pct&quot; for survival
probability in percentage.</dd>
      <dt>palette</dt>
      <dd>the color palette to be used. Allowed values include &quot;hue&quot; for
the default hue color scale; &quot;grey&quot; for grey color palettes; brewer palettes
e.g. &quot;RdBu&quot;, &quot;Blues&quot;, ...; or custom color palette e.g. c(&quot;blue&quot;, &quot;red&quot;).
See details section for more information.  Can be also a numeric vector of
length(groups); in this case a basic color palette is created using the
function <a href='http://www.rdocumentation.org/packages/grDevices/topics/palette'>palette</a>.</dd>
      <dt>ylab</dt>
      <dd>a label for oy axis.</dd>
      <dt>ggtheme</dt>
      <dd>function, ggplot2 theme name. Allowed values include ggplot2 official themes: see <code><a href='http://www.rdocumentation.org/packages/ggplot2/topics/theme'>theme</a></code>.</dd>
      <dt>...</dt>
      <dd>further arguments passed to the function <code><a href='http://www.rdocumentation.org/packages/ggpubr/topics/ggpar'>ggpar</a></code> for customizing the plot.</dd>
    </dl>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns an object of class <code>gg</code>.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Currently four approaches are implemented in the <code>ggadjustedcurves()</code> function.</p>
    <p>For <code>method = &quot;single&quot;</code> a single survival curve is calculated and plotted. The curve presents an expected survival calculated for population <code>data</code> calculated based on the Cox model <code>fit</code>.</p>
    <p>For <code>method = &quot;average&quot;</code> a separate survival curve is plotted for each level of a variable listed as <code>variable</code>. If this argument is not specified, then it will be extracted from the <code>strata</code> component of <code>fit</code> argument.  Each curve presents an expected survival calculated for subpopulation from <code>data</code> based on a Cox model <code>fit</code>. Note that in this method subpopulations are NOT balanced.</p>
    <p>For <code>method = &quot;conditional&quot;</code> a survival curve is plotted for each level of a grouping variable selected by <code>variable</code> argument. If this argument is not specified, then it will be extracted from the <code>strata</code> component of <code>fit</code> object.  Subpopulations are balanced with respect to variables in the <code>fit</code> formula to keep distributions similar to these in the <code>reference</code> population. If no reference population is specified, then the whole <code>data</code> is used as a reference population instead. The balancing is performed in a following way: (1) for each subpopulation a logistic regression model is created to model the odds of being in the subpopulation against the reference population given the other variables listed in a <code>fit</code> object, (2) reverse probabilities of belonging to a specified subpopulation are used as weights in the Cox model, (3) the Cox model is refitted with weights taken into account, (4) expected survival curves are calculated for each subpopulation based on a refitted weighted model.</p>
    <p>For <code>method = &quot;marginal&quot;</code> a separate survival curve is plotted for each level of a grouping variable selected by <code>variable</code> argument. If this argument is not specified, then it will be extracted from the <code>strata</code> component of <code>fit</code> object.  Subpopulations are balanced in a following way: (1) the data is replicated as many times as many subpopulations are considered (say k), (2) for each row in original data a set of k copies are created and for every copy a different value of a grouping variable is assigned, this will create a new dataset balanced in terms of grouping variables, (3) expected survival is calculated for each subpopulation based on the new artificial dataset. Here the model <code>fit</code> is not refitted.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>library</span>(<span class='no'>survival</span>)
<span class='no'>fit2</span> <span class='kw'>&lt;-</span> <span class='fu'>coxph</span>( <span class='fu'>Surv</span>(<span class='no'>stop</span>, <span class='no'>event</span>) ~ <span class='no'>size</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>bladder</span> )
<span class='co'># single curve</span>
<span class='fu'>ggadjustedcurves</span>(<span class='no'>fit2</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>bladder</span>)</div><img src='ggadjustedcurves-2.png' alt='' width='540' height='400' /><div class='input'>
<span class='no'>fit2</span> <span class='kw'>&lt;-</span> <span class='fu'>coxph</span>( <span class='fu'>Surv</span>(<span class='no'>stop</span>, <span class='no'>event</span>) ~ <span class='no'>size</span> + <span class='fu'>strata</span>(<span class='no'>rx</span>), <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>bladder</span> )
<span class='co'># average in groups</span>
<span class='fu'>ggadjustedcurves</span>(<span class='no'>fit2</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>bladder</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"average"</span>, <span class='kw'>variable</span> <span class='kw'>=</span> <span class='st'>"rx"</span>)</div><img src='ggadjustedcurves-4.png' alt='' width='540' height='400' /><div class='input'>
<span class='co'># conditional balancing in groups</span>
<span class='fu'>ggadjustedcurves</span>(<span class='no'>fit2</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>bladder</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"conditional"</span>, <span class='kw'>variable</span> <span class='kw'>=</span> <span class='st'>"rx"</span>)</div><img src='ggadjustedcurves-6.png' alt='' width='540' height='400' /><div class='input'><span class='co'># selected reference population</span>
<span class='fu'>ggadjustedcurves</span>(<span class='no'>fit2</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>bladder</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"conditional"</span>, <span class='kw'>variable</span> <span class='kw'>=</span> <span class='st'>"rx"</span>,
    <span class='kw'>reference</span> <span class='kw'>=</span> <span class='no'>bladder</span>[<span class='no'>bladder</span>$<span class='no'>rx</span> <span class='kw'>==</span> <span class='st'>"1"</span>,])</div><img src='ggadjustedcurves-8.png' alt='' width='540' height='400' /><div class='input'>
<span class='co'># marginal balancing in groups</span>
<span class='fu'>ggadjustedcurves</span>(<span class='no'>fit2</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>bladder</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"marginal"</span>, <span class='kw'>variable</span> <span class='kw'>=</span> <span class='st'>"rx"</span>)</div><img src='ggadjustedcurves-10.png' alt='' width='540' height='400' /><div class='input'>
<span class='co'>## Not run: ------------------------------------</span>
<span class='co'># # this will take some time</span>
<span class='co'># fdata &lt;- flchain[flchain$futime &gt;=7,]</span>
<span class='co'># fdata$age2 &lt;- cut(fdata$age, c(0,54, 59,64, 69,74,79, 89, 110),</span>
<span class='co'>#                   labels = c(paste(c(50,55,60,65,70,75,80),</span>
<span class='co'>#                                    c(54,59,64,69,74,79,89), sep='-'), "90+"))</span>
<span class='co'># fdata$group &lt;- factor(1+ 1*(fdata$flc.grp &gt;7) + 1*(fdata$flc.grp &gt;9),</span>
<span class='co'>#                       levels=1:3,</span>
<span class='co'>#                       labels=c("FLC &lt; 3.38", "3.38 - 4.71", "FLC &gt; 4.71"))</span>
<span class='co'># # single curve</span>
<span class='co'># fit &lt;- coxph( Surv(futime, death) ~ age*sex, data = fdata)</span>
<span class='co'># ggadjustedcurves(fit, data = fdata, method = "single")</span>
<span class='co'># </span>
<span class='co'># # average in groups</span>
<span class='co'># fit &lt;- coxph( Surv(futime, death) ~ age*sex + strata(group), data = fdata)</span>
<span class='co'># ggadjustedcurves(fit, data = fdata, method = "average")</span>
<span class='co'># </span>
<span class='co'># # conditional balancing in groups</span>
<span class='co'># ggadjustedcurves(fit, data = fdata, method = "conditional", reference = fdata)</span>
<span class='co'># </span>
<span class='co'># # marginal balancing in groups</span>
<span class='co'># ggadjustedcurves(fit, data = fdata, method = "marginal")</span>
<span class='co'>## ---------------------------------------------</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Przemyslaw Biecek, <a href='mailto:przemyslaw.biecek@gmail.com'>przemyslaw.biecek@gmail.com</a>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Alboukadel Kassambara, Marcin Kosinski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
